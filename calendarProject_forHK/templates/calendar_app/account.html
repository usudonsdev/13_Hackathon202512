<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒšãƒ¼ã‚¸ - Smart Scheduler</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        :root {
            /* Colors */
            --bg-primary: #f8f9fa;
            --bg-secondary: #ffffff;
            --text-primary: #1a1a1a;
            --text-secondary: #6e7c87;
            --accent-color: #3b82f6;
            --accent-hover: #2563eb;
            --danger-color: #ef4444;
            --border-color: #e5e7eb;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            
            /* Spacing */
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            
            /* Layout */
            --sidebar-width: 250px;
            --header-height: 60px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
        }

        .app-container {
            display: flex;
            height: 100%;
        }

        /* Sidebar - æ—¢å­˜ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’æµç”¨ */
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            padding: var(--spacing-md);
        }

        .logo-area h1 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: var(--spacing-lg);
            color: var(--text-primary);
        }

        .main-nav {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .nav-btn {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm) var(--spacing-md);
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            color: var(--text-secondary);
            transition: all 0.2s;
            text-align: left;
            text-decoration: none; /* aã‚¿ã‚°å‘ã‘ */
        }

        .nav-btn:hover {
            background-color: var(--bg-primary);
            color: var(--text-primary);
        }

        .nav-btn.active { /* ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒšãƒ¼ã‚¸å°‚ç”¨ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¹ã‚¿ã‚¤ãƒ« */
            background-color: var(--bg-primary);
            color: var(--text-primary);
            font-weight: 500;
        }

        .nav-btn.special-btn {
            background-color: #eff6ff;
            color: var(--accent-color);
            font-weight: 500;
        }

        .nav-btn.special-btn:hover {
            background-color: #dbeafe;
        }

        .icon-btn {
            border: none;
            background: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.9rem;
        }
        /* End Sidebar Styles */

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: var(--bg-primary);
            overflow-y: auto; /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒæº¢ã‚ŒãŸå ´åˆã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã«ã™ã‚‹ */
        }

        .top-bar {
            height: var(--header-height);
            padding: 0 var(--spacing-lg);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
        }

        .page-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        /* --- Account Specific Styles --- */
        .account-page-container {
            padding: var(--spacing-lg);
            max-width: 800px;
            margin: 0 auto;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-lg);
            padding: var(--spacing-lg) 0;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: var(--spacing-lg);
        }

        .profile-avatar {
            width: 96px;
            height: 96px;
            border-radius: 50%;
            background-color: #ccc; /* ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: var(--bg-secondary);
            flex-shrink: 0;
        }

        .profile-info h2 {
            font-size: 2rem;
            margin-bottom: var(--spacing-xs);
        }

        .profile-info p {
            color: var(--text-secondary);
            font-size: 1rem;
            margin-bottom: var(--spacing-sm);
        }

        .profile-stats {
            display: flex;
            gap: var(--spacing-lg);
            font-size: 0.9rem;
        }

        .stats-item strong {
            display: block;
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--accent-color);
        }

        .profile-section {
            background-color: var(--bg-secondary);
            padding: var(--spacing-lg);
            border-radius: 8px;
            box-shadow: var(--shadow-sm);
            margin-bottom: var(--spacing-lg);
        }

        .profile-section h3 {
            font-size: 1.25rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
        }

        .btn-primary {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: var(--spacing-sm) var(--spacing-lg);
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-primary:hover {
            background-color: var(--accent-hover);
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-sm) 0;
            border-bottom: 1px dotted var(--border-color);
        }

        .setting-item:last-child {
            border-bottom: none;
        }


        .circle-img {
            width: 100px;           /* è¡¨ç¤ºã‚µã‚¤ã‚º */
            height: 100px;          /* æ­£æ–¹å½¢ã«ã™ã‚‹ */
            object-fit: cover;      /* ç”»åƒã‚’æ ã„ã£ã±ã„ã«åˆ‡ã‚ŠæŠœã */
            border-radius: 50%;     /* ä¸¸ãã™ã‚‹ */
            border: 0px solid #ccc; /* æ ç·šï¼ˆä»»æ„ï¼‰ */
        }
        
        /* End Account Specific Styles */

    </style>
</head>
<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="logo-area">
                <h1><a href="/" style="color: inherit; text-decoration: none;">Scheduler</a></h1>
            </div>
            
            <nav class="main-nav">
                <a href="/plan/create" class="nav-btn">
                    <span class="icon">ğŸ“…</span> äºˆå®šã‚’è¿½åŠ 
                </a>
                <a href="/todo" class="nav-btn">
                    <span class="icon">ğŸ“</span> ä»Šæ—¥ã‚„ã‚‹ã“ã¨
                </a>
                <a href="/friend" class="nav-btn">
                    <span class="icon">ğŸ‘¥</span> ã¨ã‚‚ã ã¡
                </a>
                <a href="/account/view" id="sidebar-account-btn" class="nav-btn active">
                    <span class="icon">ğŸ‘¤</span> ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«
                </a>
                <a href="/assist" class="nav-btn">
                    <span class="icon">âœ¨</span> ã‚¢ã‚·ã‚¹ãƒˆ
                </a>
                <a href="/compare" class="nav-btn">
                    <span class="icon">ğŸ‘£</span>æ¯”è¼ƒ
                </a>
            </nav>

            <div class="settings-area">
                <button id="btn-settings" class="icon-btn" aria-label="Settings">âš™ï¸ è¨­å®š</button>
            </div>
        </aside>
        <main class="main-content">
            <header class="top-bar">
                <h2 class="page-title">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</h2>
            </header>

            <div class="account-page-container">
                <div class="profile-header">
                    {% if icon %}
                    <img alt="icon" src="{{ icon.url }}" class="circle-img">
                    {% else %}
                    <img alt="icon" src="https://knsoza1.com/wp-content/uploads/2025/02/4cbc0aab7c6d44a4559d83b2d733d166-300x300.png" class="circle-img">
                    {% endif %}
                    <div class="profile-info">
                        <h2 id="profile-name"></h2>
                        <p id="profile-id">@{{ user_id }}</p>
                        <div class="profile-stats">
                            <div class="stats-item">
                                <span id="stat-friends-count"><strong>{{ friends_len }}</strong></span>
                                <span>å‹é”</span>
                            </div>
                            <!-- <div class="stats-item">
                                <span id="stat-events-count"><strong>-</strong></span>
                                <span>å…¬é–‹äºˆå®š</span>
                            </div> -->
                        </div>
                    </div>
                </div>

                <div class="profile-section">
                    <h3>ğŸ“¢ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h3>
                    <p id="profile-status">...ãƒ­ãƒ¼ãƒ‰ä¸­...</p>
                </div>

                <div class="profile-section">
                    <h3>å…¬é–‹ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</h3>
                    <div id="public-schedule-list">
                        <p class="text-secondary">å…¬é–‹ã•ã‚Œã¦ã„ã‚‹äºˆå®šã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
                        </div>
                </div>

                <div id="action-area" style="text-align: center;">
                <a href="/account/edit" class="btn-primary" style="margin-right: var(--spacing-md);">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†</a>    
                </div>
            </div>
        </main>
        </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã®å–å¾— ---
            const urlParams = new URLSearchParams(window.location.search);
            // URLã‹ã‚‰ 'id' ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–å¾— (ä¾‹: ?id=user123)
            const requestedId = urlParams.get('id');
            // ãƒ‡ãƒ¢ç”¨ã®è‡ªåˆ†ã®IDï¼ˆãƒ­ã‚°ã‚¤ãƒ³ä¸­ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰ã‚’è¨­å®š
            const myUserId = 'user123'; 
            
            // è¡¨ç¤ºã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’æ±ºå®š
            const targetId = requestedId || myUserId;
            // è‡ªåˆ†ã®ãƒšãƒ¼ã‚¸ã‹ã©ã†ã‹
            const isMyPage = targetId === myUserId;


            // --- DOMè¦ç´  ---
            const pageTitleEl = document.getElementById('page-title');
            const profileNameEl = document.getElementById('profile-name');
            const profileIdEl = document.getElementById('profile-id');
            const profileAvatarEl = document.getElementById('profile-avatar');
            const profileStatusEl = document.getElementById('profile-status');
            const statFriendsCountEl = document.getElementById('stat-friends-count');
            const statEventsCountEl = document.getElementById('stat-events-count');
            const publicScheduleListEl = document.getElementById('public-schedule-list');
            const actionAreaEl = document.getElementById('action-area');
            const sidebarAccountBtn = document.getElementById('sidebar-account-btn');

            // ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ã€Œã‚¢ã‚«ã‚¦ãƒ³ãƒˆã€ãƒœã‚¿ãƒ³ã®ãƒªãƒ³ã‚¯ã‚’ã€è‡ªåˆ†ã®IDä»˜ãURLã«è¨­å®š
            sidebarAccountBtn.href = `?id=${myUserId}`;
            if (isMyPage) {
                sidebarAccountBtn.innerHTML = '<span class="icon">ğŸ‘¤</span> ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«';
            } else {
                sidebarAccountBtn.innerHTML = '<span class="icon">ğŸ‘¥</span> ã¨ã‚‚ã ã¡';
            }


            // --- ãƒ‡ãƒ¼ã‚¿å–å¾—ã¨ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®é–¢æ•° (ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰é€£æºã®ä»£ã‚ã‚Š) ---
            function fetchUserData(userId) {
                // ã“ã“ã§æœ¬æ¥ã¯ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ã‚§ãƒƒãƒã—ã¾ã™ã€‚
                console.log(`Fetching data for ID: ${userId}`);
                
                // ãƒ‡ãƒ¢ç”¨ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿
                if (userId === 'user123') {
                    return {
                        id: 'user123',
                        name: '{{ user_name }}',
                        status: '{{ bio }}',
                        friends: '{{ friends_len }}',
                        publicEvents: 3,
                        publicSchedule: [
                            { time: '{{ Plans.0 }}', title: '{{ Plans.1 }}' },
                            { time: '{{ Plans.2 }}', title: '{{ Plans.3 }}' }
                        ]
                    };
                } else if (userId === 'friend456') {
                    return {
                        id: 'friend456',
                        name: 'ä½è—¤ æ¬¡éƒ',
                        status: 'æ–°ã—ã„è¶£å‘³ã‚’è¦‹ã¤ã‘ãŸã„ï¼',
                        friends: 8,
                        publicEvents: 5,
                        publicSchedule: [
                            { time: '2025/12/09 18:30', title: 'ã‚¸ãƒ ' },
                            { time: '2025/12/12 11:00', title: 'ä¼‘æ†©' }
                        ]
                    };
                } else {
                    return null; // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ
                }
            }

            function renderAccountPage() {
                const userData = fetchUserData(targetId);

                if (!userData) {
                    pageTitleEl.textContent = 'ã‚¨ãƒ©ãƒ¼ - Smart Scheduler';
                    profileNameEl.textContent = 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“';
                    profileIdEl.textContent = 'ID: ' + targetId;
                    profileStatusEl.textContent = 'æŒ‡å®šã•ã‚ŒãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯å­˜åœ¨ã—ãªã„ã‹ã€éå…¬é–‹ã§ã™ã€‚';
                    profileAvatarEl.textContent = 'â“';
                    statFriendsCountEl.querySelector('strong').textContent = 'N/A';
                    statEventsCountEl.querySelector('strong').textContent = 'N/A';
                    publicScheduleListEl.innerHTML = '';
                    return;
                }

                // ãƒšãƒ¼ã‚¸ã®åŸºæœ¬æƒ…å ±ã‚’è¨­å®š
                pageTitleEl.textContent = `${userData.name} ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ - Smart Scheduler`;
                profileNameEl.textContent = userData.name;
                //profileIdEl.textContent = 'ID: ' + userData.id;
                profileStatusEl.textContent = userData.status;
                
                // ã‚¢ãƒã‚¿ãƒ¼ã®ã‚¤ãƒ‹ã‚·ãƒ£ãƒ«ã‚’è¨­å®š
                profileAvatarEl.textContent = userData.name.substring(0, 1) || userData.id.substring(0, 1).toUpperCase();

                // çµ±è¨ˆæƒ…å ±ã‚’è¨­å®š
                statFriendsCountEl.querySelector('strong').textContent = userData.friends;
                statEventsCountEl.querySelector('strong').textContent = userData.publicEvents;

                // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒªã‚¹ãƒˆã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
                renderPublicSchedule(userData.publicSchedule);

                // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚’åˆ‡ã‚Šæ›¿ãˆ
                renderActionButtons(isMyPage);
            }

            function renderPublicSchedule(schedule) {
                publicScheduleListEl.innerHTML = ''; // ãƒªã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢

                if (schedule && schedule.length > 0) {
                    const ul = document.createElement('ul');
                    schedule.forEach(item => {
                        const li = document.createElement('li');
                        li.innerHTML = `
                            <div class="setting-item">
                                <span>${item.time}</span>
                                <strong>${item.title}</strong>
                            </div>
                        `;
                        ul.appendChild(li);
                    });
                    publicScheduleListEl.appendChild(ul);
                } else {
                    publicScheduleListEl.innerHTML = '<p class="text-secondary">å…¬é–‹ã•ã‚Œã¦ã„ã‚‹äºˆå®šã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
                }
            }

            function renderActionButtons(isMyPage) {
                actionAreaEl.innerHTML = ''; // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¨ãƒªã‚¢ã‚’ã‚¯ãƒªã‚¢
                
                if (isMyPage) {
                    // è‡ªåˆ†ã®ãƒšãƒ¼ã‚¸ã®å ´åˆ: è¨­å®šãƒœã‚¿ãƒ³ãªã©ã‚’è¡¨ç¤º
                    //actionAreaEl.innerHTML = `
                    //    <a href="/account/edit" class="btn-primary" style="margin-right: var(--spacing-md);">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†</a>
                    //`;
                } else {
                    // ä»–äººã®ãƒšãƒ¼ã‚¸ã®å ´åˆ: å‹é”è¿½åŠ ãƒœã‚¿ãƒ³ãªã©ã‚’è¡¨ç¤º
                    actionAreaEl.innerHTML = `
                        <button class="btn-primary" onclick="alert('å‹é”ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã—ãŸï¼')">å‹é”ã«è¿½åŠ </button>
                    `;
                }
            }
            
            // --- åˆæœŸåŒ– ---
            renderAccountPage();
        });
    </script>
</body>
</html>
